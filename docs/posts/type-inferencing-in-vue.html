<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="author" content="Abhisek Mallick"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="revisit-after" content="7 days"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta name="msapplication-TileColor" content="#ffffff"><title>Type Inferencing in Vue</title><script>!function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" crossorigin="" src="/assets/app-CKbQotus.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-CJCeAmPF.css"><link rel="modulepreload" crossorigin="" href="/assets/type-inferencing-in-vue-CX86SJh3.js"><meta property="og:title" content="Type Inferencing in Vue"><meta name="twitter:title" content="Type Inferencing in Vue"><meta property="og:image" content="https://antfu.me/og/type-inferencing-in-vue.png"><meta name="twitter:image" content="https://antfu.me/og/type-inferencing-in-vue.png"><meta name="twitter:card" content="summary_large_image"></head><body class="font-sans text-gray-700 dark:text-gray-200 relative"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-c774d4db=""><a href="/" class="w-12 h-12 absolute xl:fixed m-5 select-none outline-none" focusable="false" data-v-c774d4db="">A </a><button title="Scroll to top" fixed="" right-3="" bottom-3="" w-10="" h-10="" hover:op100="" rounded-full="" hover-bg-hex-8883="" transition="" duration-300="" z-100="" print:hidden="" class="op0! pointer-events-none" data-v-c774d4db=""><div i-ri-arrow-up-line="" data-v-c774d4db=""></div></button><nav class="nav" data-v-c774d4db=""><div class="spacer" data-v-c774d4db=""></div><div class="right" print:op0="" data-v-c774d4db=""><a href="/posts" class="router-link-active" title="Blog" data-v-c774d4db=""><span class="lt-md:hidden" data-v-c774d4db="">Blog</span><div i-ri-article-line="" md:hidden="" data-v-c774d4db=""></div></a><a href="/talks" class="lt-md:hidden" title="Talks" data-v-c774d4db="">Talks </a><a href="/sponsors-list" class="" title="Sponsors" data-v-c774d4db=""><span class="lt-md:hidden" data-v-c774d4db="">Sponsors</span><div i-ri-heart-line="" class="md:hidden" data-v-c774d4db=""></div></a><a href="https://x.com/Abhisek_217" target="_blank" title="Twitter" class="lt-md:hidden" data-v-c774d4db=""><div i-ri-twitter-x-fill="" data-v-c774d4db=""></div></a><a href="https://github.com/abhisek-ai" target="_blank" title="GitHub" class="lt-md:hidden" data-v-c774d4db=""><div i-uil-github-alt="" data-v-c774d4db=""></div></a><a class="select-none" title="Toggle Color Scheme" data-v-c774d4db=""><div i-ri-sun-line="" dark:i-ri-moon-line=""></div></a></div></nav></header><main class="px-7 py-10 of-x-hidden"><!--[--><!----><div class="prose m-auto mb-8"><h1 class="mb-0 slide-enter-50">Type Inferencing in Vue</h1><p class="opacity-50 !-mt-6 slide-enter-50">Jun 27, 2020<!----></p><!----><!----><!----></div><article class=""><!--[--><div class="prose m-auto slide-enter-content"><p></p><div class="table-of-contents"><div class="table-of-contents-anchor"><div class="i-ri-menu-2-fill"></div></div><ul><li><a href="#type-for-this">Type for this</a><ul><li><a href="#thistype">ThisType</a></li></ul></li></ul></div><p></p><p>As you may or may not know, I am working on preparing to release the v1.0 version for <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener">@vue/composition-api</a> recently. One of the current problems is that the type inference does not play well <a href="https://github.com/vuejs/composition-api/issues/338" target="_blank" rel="noopener">#338</a>. So I get a chance to have a deeper look at <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener">vue-next</a>â€™s type implementations. I will tell you what I learned and how magic works in Vue.</p><p>Forget about the <code>setup()</code> function and <code>Composition API</code> for now, let talk about the options API in Vue 2 that everybody familiar with. In a classical example, we would have <code>data</code>, <code>computed</code>, <code>methods</code> and some other fields like this:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-js"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  data</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    first_name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Anthony</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    last_name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Fu</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  computed</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    full_name</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#C98A7D;--s-light:#B56959">first_name</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> ${</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#C98A7D;--s-light:#B56959">last_name</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  methods</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    hi</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      alert</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">full_name</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>It works well in JavaScript and putting all the context into <code>this</code> is pretty straightforward and easy to understand. But when you switch to TypeScript for static type checking. <code>this</code> will not be the context you expected. How can we make the types work for Vue like the example above?</p><h2 id="type-for-this" tabindex="-1">Type for <code>this</code> <a class="header-anchor" href="#type-for-this" aria-hidden="true">#</a></h2><p>To explicitly assign the type to <code>this</code>, we can simply use the <code>this parameter</code>:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-ts"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Context</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  $injected</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> bar</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Context</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">  this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$injected</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>The limitation of this approach is that we will lose the signature of the method when working with a dict of methods:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-ts"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Methods</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Record</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Context</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> ...</span><span style="--s-dark:#BD976A;--s-light:#B07D48">args</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span><span style="--s-dark:#666666;--s-light:#999999">[])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Methods</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  bar</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">    this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$injected</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">bar</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">bar</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // no error, the type of arguments becomes `any[]`</span></span></code></pre><p>We would not want to ask users to explicitly type <code>this</code> in every method in order to make the type checking works. So we will need another approach.</p><h3 id="thistype" tabindex="-1"><a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#thistypet" target="_blank" rel="noopener"><code>ThisType</code></a> <a class="header-anchor" href="#thistype" aria-hidden="true">#</a></h3><p>After digging into Vueâ€™s code, I found an interesting TypeScirpt utility <code>ThisType</code>. The official doc says:</p><blockquote><p>This utility does not return a transformed type. Instead, it serves as a marker for a contextual <code>this</code> type.</p></blockquote><p><code>ThisType</code> would affect all the nested functions. With it, we can have:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-ts"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Methods</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  double</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  deep</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    nested</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      half</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Methods</span><span style="--s-dark:#666666;--s-light:#999999"> &amp; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ThisType</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Methods</span><span style="--s-dark:#666666;--s-light:#999999"> &amp; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Context</span><span style="--s-dark:#666666;--s-light:#999999">&gt; =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  double</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">    this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$injected</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> a</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> *</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 2</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  deep</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    nested</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      half</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">a</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">        this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$injected</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> a</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> /</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 2</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">double</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">2</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">double</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // error</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">methods</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">deep</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">nested</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">half</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">4</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span></code></pre><p>The typing works well, but it still requires users to define the type interface of Methods first. Can we make it infer itself automatically?</p><p>We can do that with function inference:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-ts"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Options</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  methods</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#666666;--s-light:#999999"> &amp;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> ThisType</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999"> &amp;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Context</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> define</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Options</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> options</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">define</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  methods</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    foo</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">      this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$injected</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><p>There is only one step left, to make context object dynamic inference from <code>data</code> and <code>computed</code>.</p><p>The full working demo would be:</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-ts"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">/* ---- Type ---- */</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> ExtractComputedReturns</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  [</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">key</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> in</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> keyof</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#666666;--s-light:#999999">]: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">[</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">key</span><span style="--s-dark:#666666;--s-light:#999999">] </span><span style="--s-dark:#CB7676;--s-light:#AB5959">extends</span><span style="--s-dark:#666666;--s-light:#999999"> (...</span><span style="--s-dark:#BD976A;--s-light:#B07D48">args</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span><span style="--s-dark:#666666;--s-light:#999999">[]) =&gt; </span><span style="--s-dark:#CB7676;--s-light:#AB5959">infer</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> TReturn</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    ?</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> TReturn</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    :</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> never</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Options</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">D</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {},</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> C</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {},</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> M</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {}&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  data</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">D</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computed</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">C</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  methods</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">M</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  mounted</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // and other options</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&amp;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> ThisType</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">D</span><span style="--s-dark:#666666;--s-light:#999999"> &amp;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> M</span><span style="--s-dark:#666666;--s-light:#999999"> &amp;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> ExtractComputedReturns</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">C</span><span style="--s-dark:#666666;--s-light:#999999">&gt;&gt;</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // merge them together</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> define</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">D</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> C</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> M</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Options</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">D</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">C</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">M</span><span style="--s-dark:#666666;--s-light:#999999">&gt;)</span><span style="--s-dark:#666666;--s-light:#999999"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">/* ---- Usage ---- */</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">define</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  data</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      first_name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Anthony</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      last_name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Fu</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  computed</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    fullname</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#C98A7D;--s-light:#B56959">first_name</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> ${</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#C98A7D;--s-light:#B56959">last_name</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  methods</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    notify</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      alert</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  mounted</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">    this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">notify</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fullname</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre></div><!--]--></article><div class="prose m-auto mt-8 mb-8 slide-enter animate-delay-500 print:hidden"><!----><br><span font-mono="" op50="">&gt; </span><a href="/posts" class="router-link-active font-mono op50 hover:op75"></a></div><!--]--><div class="mt-10 mb-6 prose m-auto flex slide-enter animate-delay-1200!"><div class="flex-auto"></div></div></main><!----><!--]--></div><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></body></html>